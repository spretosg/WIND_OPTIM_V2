---
title: "4b_Q1"
author: "R.Spielhofer"
date: "9 Dezember 2020"
output: html_document
---

```{r setup, include=FALSE}

require(raster)
require(rgdal)
require(dplyr)
require(sf)
require(sp)
require(ggplot2)
require(tmap)
require(tmaptools)
require(DBI)
require(RPostgreSQL)
require(rpostgis)
require(ggpubr)
require(spatstat)
require(rstatix)
require(reticulate)
require(tidyr)
require(maptools)
require(RPostgres)
require(stringr)
require(car)
library(onewaytests)
library(psych)
library(plot3D)
```

#Load the pareto data
```{r}
cur_dat<-Sys.Date()
#here we import the best model runs for each
pareto<-read.csv("D:/04_PROJECTS/2001_WIND_OPTIM/WIND_OPTIM_git/intermediate_steps/3_wp/NSGA3_RES/out/fitness_selection_201228.csv", sep=",")

# restrictive scen
tmp_dat<-subset(pareto, pareto$SCEN=="B3"|pareto$SCEN=="B3_FOR+"|pareto$SCEN=="B3_ISOS+"|pareto$SCEN=="B3_CRF+")

#relaxing scen
tmp_dat<-subset(pareto, pareto$SCEN=="B4"|pareto$SCEN=="B4_FOR-"|pareto$SCEN=="B4_ISOS-"|pareto$SCEN=="B4_CRF-")
```

# Check data variance and distribution
```{r preconditions}
#1. CHECK FOR NORMAL DISTR
a<-as.data.frame(pareto %>%
  group_by(SCEN) %>%
  shapiro_test(ENERDENS))
write.csv(a, paste("Y:/people/spreto/01_ETH/02_PUBLICATIONS/01_MAIN/3_WIND_OPTIM/Tables/",paste(cur_dat,"shap_tmp.csv",sep="_"),sep=""))

#density plots per scen
ggplot(data=pareto, aes(x=ENERDENS, group=SCEN, fill=SCEN)) +
    geom_density(adjust=1.5)+ 
    facet_wrap(~SCEN) 
#homogeneity of variance
levene_test(tmp_dat,N_WT~SCEN,center = mean)
```

## and the appropriate test to compare the scenario means
```{r tests}

# if both not normal and inhomogeneity of variances == man whitney u test
#make comparison group manual
tmp_dat2<-subset(tmp_dat, tmp_dat$SCENARIO=="B4"|tmp_dat$SCENARIO=="B4_CRF-")

wilcox.test(tmp_dat2$N_WT ~ tmp_dat2$SCENARIO)

#if normal distributed but homogen variances == welch t.test
w<-welch.test(N_WT~SCENARIO,tmp_dat)
paircomp(w)
#if both given == t.test
t.test(a$number_WT,b$number_WT,alternative = "two.sided", var.equal = FALSE)

```



```{r}
#######Box plots to explore the data of the three goals for each scenario
clus<-ggplot(pareto, aes(x=as.factor(POLICY), y=CLUS, fill = POLICY)) +   
    geom_boxplot()+
    facet_wrap(~RESTRICTION)+
    #theme_light()+
    theme(legend.position = "none")+
    scale_fill_manual(values=c("#FF8000", "#0080ff","#00994D", "#ff33ff"))+
    labs(x ="POLICIES", y = "Clark-Evans ind. <--min")

n_WT<-ggplot(pareto, aes(x=as.factor(POLICY), y=N_WT, fill = POLICY)) +   
    geom_boxplot()+
    facet_wrap(~RESTRICTION)+
    #theme_light()+
    theme(legend.position = "none")+
    scale_fill_manual(values=c("#FF8000", "#0080ff","#00994D", "#ff33ff"))+
    labs(x ="POLICIES", y = "number of WT. <--min")+
    theme(axis.title.x = element_blank()) 
    
ener<-ggplot(pareto, aes(x=as.factor(POLICY), y=ENERDENS, fill = POLICY)) +   
    geom_boxplot()+
    facet_wrap(~RESTRICTION)+
    #theme_light()+
    theme(legend.position = "none")+
    scale_fill_manual(values=c("#FF8000", "#0080ff","#00994D", "#ff33ff"))+
    labs(x ="POLICIES", y = "Energy density [MWh/yha]. --> max")+
    theme(axis.title.x = element_blank())

plot_tmp<-ggarrange(ener, n_WT, clus,  ncol = 1,nrow = 3, common.legend = T,labels = "auto")    
jpeg(file=paste("D:/04_PROJECTS/2001_WIND_OPTIM/WIND_OPTIM_git/intermediate_steps/4_wp/descriptives/",paste(cur_dat,"_fitness_box.jpg",sep=""),sep=""),width = 1500, height = 2000)
plot(plot_tmp)
dev.off()

```

